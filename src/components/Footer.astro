---
import footerConfig from "../lib/footer";
import { withBase } from "../lib/paths";
import { Image } from "astro:assets";
import RepeatingLogoBackground from "./RepeatingLogoBackground.astro";
import logo from '../assets/logos/creme/logo.png';

function isExternalLink(href: string): boolean {
  return href.startsWith('http://') || href.startsWith('https://');
}

function isMailto(href: string): boolean {
  return href.startsWith('mailto:');
}
---
<footer role="contentinfo" class="relative w-full mt-auto text-[var(--pyre-creme)]">
  <RepeatingLogoBackground aria-hidden="true" class="absolute inset-0" positionClass="bg-center" />
  <div class="absolute inset-0 bg-[var(--pyre-black)] opacity-90" aria-hidden="true"></div>

  <div class="relative z-10 mx-auto w-full px-4 py-12 sm:py-16 md:py-20 sm:max-w-screen-sm md:max-w-screen-md lg:max-w-screen-lg xl:max-w-screen-xl">
    <div class="flex flex-col lg:flex-row lg:items-start lg:gap-16">
      <!-- Brand -->
      <div class="mb-8 lg:mb-0 lg:mr-12 lg:flex-shrink-0 lg:w-[clamp(200px,20vw,300px)] flex items-start">
        <Image
          src={logo}
          alt="Pyre Sauna logo"
          width="800"
          height="220"
          class="h-[clamp(100px,10vw,100px)] w-auto" 
          loading="lazy"
          decoding="async"
        />
      </div>
      <!-- Footer Content -->
      <div class="flex-1 grid grid-cols-2 gap-8 md:grid-cols-4 lg:grid-cols-4">
        {footerConfig.groups && footerConfig.groups.length > 0 && (
          <div class="col-span-2 md:col-span-4 lg:col-span-4 grid grid-cols-2 gap-8 md:grid-cols-3 lg:grid-cols-5">
            {footerConfig.groups.map((group) => (
              <nav aria-label={`Footer - ${group.title}`}>
                <h3 class="font-primary-semibold uppercase tracking-wide text-sm mb-2">{group.title}</h3>
                <ul class="space-y-2">
                  {group.links.map((link) => {
                    const href = link.href;
                    const ariaLabel = link.ariaLabel ?? (isMailto(href) ? `Email ${href.replace('mailto:', '')}` : undefined);
                    const isExternal = isExternalLink(href);
                    const isEmail = isMailto(href);
                    const finalHref = isExternal || isEmail ? href : withBase(href);
                    return (
                      <li>
                        <a
                          href={finalHref}
                          aria-label={ariaLabel}
                          target={isExternal ? '_blank' : undefined}
                          rel={isExternal ? 'noopener noreferrer' : undefined}
                          class="underline underline-offset-4 hover:no-underline focus:no-underline"
                        >
                          {link.label}
                        </a>
                      </li>
                    );
                  })}
                </ul>
              </nav>
            ))}
          </div>
        )}
      </div>
    </div>
    <div class="mt-10 pt-4 text-xs text-[var(--pyre-creme)]/80">
      {footerConfig.elements.copyright}
    </div>
  </div>
</footer>