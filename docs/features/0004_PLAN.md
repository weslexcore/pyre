## 0004 Plan — TailwindCSS Migration & Enforcement + Mailing List Sign‑up and Hero Refactor

### Context
Convert all styling to Tailwind utility classes declared directly on elements and establish guardrails to keep the project Tailwind‑first. Ensure the landing page includes the newsletter sign‑up immediately below the hero, and a top‑right hero CTA that anchors/scrolls to the sign‑up block. Use the exact copy from the brief:
- “Sign up for our newsletter and stay updated on opening and introductory offers.”
- “We will only send essential info and tangible offers.”
- CTA label: “Join the mailing list”.

Current state already implements `Hero.astro`, `Button.astro`, `SignupForm.astro`, header CTA, and `/api/subscribe`. This plan focuses on completing the Tailwind migration, removing lingering component CSS from `global.css`, and adding enforcement tooling and rules.

### Scope of changes (files and what to change)
- `src/components/Hero.astro`
  - Replace usage of helper classes from `global.css` (e.g., `.hero-row`, `.hero-side-left`, `.hero-side-right`, `.hero-overlay`) with Tailwind utilities inline.
  - Keep current background image and layout structure but express layout using Tailwind grid/flex, spacing, and responsive utilities. Ensure equivalent mobile breakpoint behavior currently provided by the `@media (max-width: 640px)` block is reproduced with `sm:` and default classes.
  - Use Tailwind utilities for typography and tracking instead of custom classes like `text-scale-*` and `kern-tight` where feasible; use arbitrary values where exact scale is desired (e.g., `text-[clamp(...)]`).

- `src/components/SignupForm.astro`
  - Verify verbatim copy and ARIA are present (they are). Keep progressive enhancement: plain POST + JSON fetch path.
  - Ensure all styling uses Tailwind utilities. Prefer `focus-visible:outline` patterns using Tailwind variables, and keep inline utilities over custom classes. Confirm the button uses shared `Button` API.
  - Keep client‑side validation and disable/enable submit button behavior.

- `src/components/Button.astro`
  - Confirm variants map to theme tokens using CSS variables already defined (primary/secondary/outline). Keep utilities inline. Ensure hover/focus states are via Tailwind utilities and tokens, not custom selectors.

- `src/pages/index.astro`
  - Keep header CTA using `<Button href="#signup" variant="outline" size="sm">Join the mailing list</Button>` and ensure smooth scroll works (global `html { scroll-behavior: smooth; }`).
  - Verify section order: `<Hero />` then `<SignupForm />`.

- `src/pages/api/subscribe.ts`
  - No data layer changes. Keep current algorithm: detect `content-type`, parse JSON or `formData`, validate email via regex, return JSON 200/400 for JSON requests, otherwise 303 redirect to `/?subscribed=1`.

- `src/styles/global.css`
  - Reduce to resets, fonts, CSS variables/theme tokens, and rare primitives only.
  - Remove component‑specific helpers: `.hero-row`, `.hero-side-left`, `.hero-side-right`, `.hero-overlay` (migrate to Tailwind in `Hero.astro`).
  - Replace usage of `.text-scale-*`, `.kern-*`, and other typography helpers in templates with Tailwind utilities (`text-*`, `tracking-*`, `font-*`, arbitrary sizes when needed). After migration, delete these helpers from `global.css`.
  - Keep brand tokens (OKLCH variables) and base `@layer base` variable application. Retain `bg-repeating-logo` only if still used.
  - Keep smooth scrolling rule.

- Tooling and config
  - Prettier: add `prettier-plugin-tailwindcss` and enable class sorting.
    - devDep: `prettier`, `prettier-plugin-tailwindcss`.
    - Config: `.prettierrc` with `{ "plugins": ["prettier-plugin-tailwindcss"] }` (or equivalent in package.json `prettier`).
  - ESLint (optional, recommended): add `eslint`, `eslint-plugin-tailwindcss` and rule to validate class names and config.
    - If adopting, add basic `.eslintrc` extending recommended Tailwind config.
  - Cursor rule: add/update rule in `.cursor/rules/` to enforce Tailwind‑first styling: “Always use TailwindCSS utility classes on elements. Avoid new custom classes and `@apply` unless a utility cannot express the requirement. Global CSS limited to resets, fonts, and rare, shared primitives.”
  - Evaluate `daisyui` usage. If no DaisyUI components are used beyond theme tokens, consider removing the plugin to simplify. Otherwise, keep it strictly for theme variables.

### Detailed migration steps
1) Hero component migration
   - Translate grid helpers: `.hero-row` → `grid grid-cols-[1fr_auto_1fr] items-center gap-4 sm:max-*` with responsive collapse to single column on small screens using `sm:`/default classes.
   - Side alignment: `.hero-side-left` → `justify-self-end`; `.hero-side-right` → `justify-self-start`; replace with Tailwind equivalents (`justify-self-end`/`justify-self-start`) inline.
   - Overlay: `.hero-overlay` → absolute inset background gradient via Tailwind arbitrary bg using `bg-[linear-gradient(...)]` on a positioned element.
   - Typography: replace `text-scale-4`/`text-scale-3` and `kern-tight` with Tailwind text sizes/tracking or arbitrary sizes to preserve current look.

2) Remove component helpers from `global.css`
   - Delete `.hero-row`, `.hero-side-left`, `.hero-side-right`, `.hero-overlay` and the related `@media` block once the hero is fully migrated.
   - Remove typography helpers after templates stop using them.

3) Tailwind enforcement guardrails
   - Add Prettier Tailwind plugin and run formatting to sort classes.
   - Optionally enable `eslint-plugin-tailwindcss` to catch invalid classes and config drifts.
   - Add/adjust Cursor rule file in `.cursor/rules/` to flag non‑Tailwind class usage and discourage new global/component CSS.

### Algorithmic notes (newsletter flow)
- Client: on submit, validate email with `/^\[^\s@]+@\[^\s@]+\.[^\s@]+$/`. If invalid, block submit and show inline error; otherwise, if `fetch` present, POST JSON to `/api/subscribe` and show success/error messaging; else allow normal form POST.
- Server: detect JSON vs form, trim email, validate with same pattern. JSON: return 200 `{ ok: true }` or 400 `{ error: 'Invalid email' }`. Form: redirect 303 to `/?subscribed=1` or 400 text on invalid input.

### Phase breakdown
- Phase 1 — Enforcement infra
  - Add Prettier Tailwind plugin config; run format.
  - Optionally add ESLint + Tailwind plugin and minimal config.
  - Add Cursor Tailwind‑first rule in `.cursor/rules/`.

- Phase 2 — Component migration
  - Migrate `src/components/Hero.astro` off `.hero-*` helpers to pure Tailwind utilities.
  - Verify `src/components/SignupForm.astro` and `src/components/Button.astro` are fully Tailwind‑utility based; adjust if any custom helpers remain.

- Phase 3 — CSS cleanup
  - Prune removed helpers from `src/styles/global.css` and leave only resets, fonts, variables/tokens, and rare primitives.
  - Re‑verify pages render identically at key breakpoints.

### Acceptance checklist
- Header CTA “Join the mailing list” anchors/scrolls to `#signup`.
- Signup block shows the specified copy and privacy reassurance verbatim.
- No component/page relies on `.hero-*`, `.text-scale-*`, or `.kern-*` helpers; all are Tailwind utilities inline.
- Prettier sorts Tailwind class lists; optional ESLint validates class names.
- Global CSS is minimized to resets, fonts, tokens, and rare primitives.

### Out of scope
- Third‑party email provider integration; persistence remains stubbed.
- Large visual redesign; migration is like‑for‑like in appearance.


