## Feature Plan: 0007 — Navbar Fade‑in on Scroll

### Context
Introduce a transparent navbar that smoothly fades to a black background once the user begins scrolling the page (leaving the top/hero). While at the very top of the page, the navbar remains transparent to showcase the hero imagery; past the threshold, it gains a subtle black background (with optional slight blur and shadow) to improve contrast and legibility. Use Astro with Tailwind CSS, an IntersectionObserver watching a top sentinel (1px spacer) to toggle a `scrolled` state, apply conditional classes like `bg-black/80` and `transition-colors duration-200–300`, and respect `prefers-reduced-motion`.

Verbatim requirements from brief:
- "transparent navbar that smoothly fades to a black background once the user begins scrolling"
- "while at the very top of the page, the navbar remains transparent"
- "optional slight blur and shadow"
- "Use an IntersectionObserver on a top sentinel (e.g., hero or a 1px spacer) to toggle a `scrolled` state"
- "Apply conditional classes on the navbar when `scrolled` is true: background `bg-black/80` (or `bg-black`), `transition-colors` and `duration-200–300`; optional `backdrop-blur` and `shadow`"
- "Respect `prefers-reduced-motion` by shortening/removing transition durations for users who opt out"
- "Ensure consistent behavior across all pages that use the main layout navbar"

### Files to Create or Edit

1) Create `src/components/Navbar.astro`
   - Purpose: Centralize the fixed navbar so behavior is consistent across all pages.
   - Markup: Based on existing header in `src/pages/index.astro` (logo at left, CTA button at right). Keep layout classes and spacing.
   - Container classes (initial): `fixed inset-x-0 top-0 z-50 bg-transparent transition-colors duration-300 motion-reduce:transition-none`.
   - Data hook: Add an attribute like `data-component="navbar"` on the header element for targeted scripting.
   - Scrolled state classes (when active): add `bg-black/80` (or `bg-black`), optional `backdrop-blur` and `shadow`.
   - Script (client-side): set up `IntersectionObserver` to watch the sentinel and toggle the scrolled classes on the header element. No framework dependency required.

2) Edit `src/layouts/main.astro`
   - Import and render `<Navbar />` as the first element inside `<body>`.
   - Immediately after the navbar, insert a 1px sentinel element: `<div id="nav-sentinel" aria-hidden="true" class="h-px w-0"></div>`.
   - Keep `<slot />` content unchanged so pages render as-is beneath the navbar. This ensures the behavior applies to all pages using this layout.

3) Edit `src/pages/index.astro`
   - Remove the inline `<header ...>` block (the navbar) currently present at the top of the page.
   - Do not alter hero structure; maintain existing top padding within hero content (`pt-24`) so content remains visually balanced beneath the fixed navbar.

4) Optional `src/styles/global.css`
   - No required global utilities. If desired, document that Tailwind utilities like `motion-reduce:transition-none` can be used directly on the navbar element to respect reduced motion.

### Behavior and Algorithm (Step-by-step)

- Sentinel placement and purpose
  1. A 1px-high invisible sentinel (`#nav-sentinel`) sits directly below the fixed navbar.
  2. When the page is at the very top, the sentinel intersects the viewport; when the user scrolls down, the sentinel leaves the viewport.

- IntersectionObserver logic
  1. On client load, select the navbar header via `[data-component="navbar"]` and the sentinel via `#nav-sentinel`.
  2. Configure an `IntersectionObserver` with `{ root: null, threshold: 0 }`. `rootMargin` can remain `0px` since the element is 1px tall.
  3. In the observer callback:
     - If `entry.isIntersecting === true`: ensure the navbar is transparent by removing the scrolled-state classes (`bg-black/80`, `backdrop-blur`, `shadow`).
     - If `entry.isIntersecting === false`: add the scrolled-state classes to the navbar element.
  4. Observe the sentinel. The observer fires immediately, establishing the correct initial state (including on back/forward navigations).
  5. Fallback (robustness): If the sentinel is not found, initialize by checking `window.scrollY > 0` and attach a passive `scroll` listener that updates the state using `requestAnimationFrame` to throttle.

- Tailwind classes and motion preferences
  - Initial navbar classes include `transition-colors duration-300` for a smooth fade.
  - Add `motion-reduce:transition-none` (or shorter `duration-100`) to respect `prefers-reduced-motion`.
  - Scrolled state applies `bg-black/80` (or `bg-black` for maximum contrast), with optional `backdrop-blur` and `shadow` for polish.

### Accessibility, Performance, and UX

- Contrast and legibility: Black background on scroll ensures navigation items remain readable against varied backgrounds.
- No layout shift: The navbar remains `fixed`; only background/visual styles change.
- Performance: One observer instance; passive fallback scroll listener; minimal DOM work (class toggles only). Avoids forced reflows.
- Reduced motion: Respect `prefers-reduced-motion` via Tailwind utility to disable/shorten transitions.
- SEO and semantics: No change to document structure; header remains semantic.

### Testing and Verification

- At top of page: Navbar is fully transparent; sentinel is intersecting; no backdrop blur/shadow.
- After scrolling 1–2px: Navbar gains `bg-black/80` with smooth `transition-colors` (`duration-200–300`), optional `backdrop-blur` and `shadow` applied.
- Back to top: Styles revert to transparent smoothly.
- Mobile/tablet/desktop: Verify visual consistency and touch scroll behavior.
- Safari/iOS: Confirm `backdrop-blur` functions (acceptable to proceed without blur if unsupported; background color still applied).
- Reduced motion: With `prefers-reduced-motion` enabled, ensure transitions are removed/shortened.
- Non-hero pages: Navbar should still fade once content scrolls; behavior is page-agnostic due to the sentinel below the navbar.

### Impacted Files Summary

- New: `src/components/Navbar.astro`
- Edit: `src/layouts/main.astro` (add `<Navbar />` and sentinel)
- Edit: `src/pages/index.astro` (remove inline navbar)
- Optional: `src/styles/global.css` (document motion utilities if needed)


