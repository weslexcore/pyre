## Feature 0003 — Mailing List Sign-up + Hero Refactor

### Context
Add an email sign-up flow to the landing page and refactor the hero for maintainability.
- Place a newsletter sign-up section directly below the hero. It collects an email address and includes supporting copy: “Sign up for our newsletter and stay updated on opening and introductory offers.” Plus a privacy reassurance: “We will only send essential info and tangible offers.”
- Add a “Join the mailing list” button to the top-right of the hero.
- Create a reusable `Button` component for visual consistency across CTAs.
- Extract the hero into its own `Hero` component.

Style system: Prefer Tailwind utilities per workspace guidelines; keep `global.css` for tokens/resets and existing utilities. The existing API `src/pages/api/subscribe.ts` already supports both form POST and JSON.

---

### Files to Add

1) `src/components/Button.astro`
- Purpose: Shared CTA and action button to ensure consistent spacing, colors, focus states.
- API (props):
  - `variant`: "primary" | "secondary" | "outline" (maps to brand 2-color rule)
  - `size`: "sm" | "md" | "lg"
  - `href?`: string (renders an anchor styled as button if present)
  - `type?`: "button" | "submit" (default: submit when used in forms)
  - `ariaLabel?`: string
  - `class?`: string (allow additive utilities when needed)
- Behavior: Uses Tailwind utilities only; no new global selectors. Focus ring uses existing `--ring` token from `global.css`.

2) `src/components/Hero.astro`
- Purpose: Encapsulate the full hero section used on `/` with background image, overlay, center content, and bottom line.
- Structure and content (parity with current `src/pages/index.astro`):
  - Background image `/images/hero.png` with overlay (reuse existing `hero-overlay` utility)
  - Top line: “The Bathhouse, Reimagined”
  - Center row: left “Self-care.”, center logo `/logos/creme/logo.png`, right “Together.”
  - Bottom line: “Richmond VA + Spring 2026”
- Props: none initially (static hero); design for future props like `headline`, `subheadLeft`, `subheadRight`, `backgroundSrc`.

3) `src/components/SignupForm.astro`
- Purpose: Accessible newsletter signup section placed immediately below hero.
- Markup requirements:
  - Section wrapper with `id="signup"` and a heading, e.g., “Stay in the loop”.
  - Supporting copy (verbatim): “Sign up for our newsletter and stay updated on opening and introductory offers.”
  - Privacy reassurance (verbatim): “We will only send essential info and tangible offers.”
  - `<form method="POST" action="/api/subscribe" novalidate>`
  - Email label and input:
    - `<label for="email">Email address</label>`
    - `<input id="email" name="email" type="email" required inputmode="email" autocomplete="email">`
    - Inline validation container with `aria-live="polite"` and `id="email-error"`
  - Submit control uses `Button` with `type="submit"` and copy “Join”
- Client enhancement (progressive): Optional script that intercepts submit, validates email, posts `application/json` to `/api/subscribe`, and shows inline success/error, while letting standard POST/303 redirect work if JS is unavailable.

---

### Files to Modify

1) `src/pages/index.astro`
- Replace inlined hero markup with `<Hero />` component.
- Header CTA: add a right-aligned `Button` in the fixed header linking to `#signup` with text “Join the mailing list”.
- Insert `<SignupForm />` section immediately below `<Hero />`.
- Success state: detect `Astro.url.searchParams.get('subscribed') === '1'` and render a non-intrusive success notice near the signup section (server fallback path). Keep notice text concise, e.g., “Thanks for subscribing!”

2) `src/styles/global.css`
- No new global selectors. Continue to rely on existing utilities (`container`, `hero-overlay`, `hero-row`) and Tailwind classes for layout and spacing.

---

### Server/API
- Reuse `src/pages/api/subscribe.ts` as-is. It supports:
  - `application/json` body: returns `{ ok: true }` on success, `{ ok: false, error: 'Invalid email' }` with 400 on invalid input.
  - Non-JSON form POST: 303 redirect to `/?subscribed=1` on success; 400 on invalid.
- No provider integration in this scope (stub remains for future wiring).

---

### UX, Accessibility, and Validation
- Labels and focus: Inputs have visible `<label>` and clear focus states using the brand ring. Maintain adequate contrast.
- Keyboard support: Form is fully operable via keyboard; CTA anchor is a link styled as button.
- Inline validation:
  - Show error message under the field when email is empty or fails `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`.
  - Announce errors via `aria-live` region.
  - Disable submit while async request is in-flight; re-enable on completion.
- Smooth scroll: rely on global `html { scroll-behavior: smooth; }` when clicking the hero CTA linking to `#signup`.

---

### Step-by-step Algorithms

1) Progressive enhancement submit flow
1. User clicks “Join” in the signup form.
2. If JS disabled: browser submits `POST` form → server validates → on success issues `303` to `/?subscribed=1` → page loads and shows success notice.
3. If JS enabled: intercept submit, read `email`, run regex validation.
   - If invalid: set inline error text and focus the field; do not send network request.
   - If valid: send `POST /api/subscribe` with `Content-Type: application/json` and `{ email }`.
   - On 200: clear the field, render inline success message.
   - On 400: show server error message inline.
   - On 500: show generic error inline.

2) Hero CTA navigation
1. User clicks “Join the mailing list” in the top-right of the hero/header.
2. Browser scrolls to `#signup` section using smooth scroll (native CSS behavior).

---

### Component Usage Contracts
- `Button` variants map to brand tokens in `global.css` via Tailwind classes; avoid introducing new custom CSS.
- `Hero` renders only presentational content; CTA link lives in the page header to keep `Hero` component purely presentational and reusable.
- `SignupForm` owns its inline validation and optional fetch; it does not import global utilities beyond Tailwind classes.

---

### Testing and Verification
- Non-JS path: Manually submit the form and verify redirect to `/?subscribed=1` and presence of success notice.
- JS path: With dev tools network tab, verify JSON POST, success and error branches.
- Accessibility: Tab through header CTA → form → submit; ensure visible focus and screen reader announcement of errors.
- Responsive: Verify layout and spacing on 320px, 768px, 1024px widths.


